<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ - Ù…Ø¹Ø§Ù…Ù„ 213 Ùˆ 215</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root {
      --bg: #f7f7f8; --card:#fff; --text:#0f172a; --muted:#64748b; --border:#e2e8f0; --primary:#0ea5e9; --danger:#ef4444; --success:#22c55e; --accent:#8b5cf6;
    }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Naskh Arabic", Cairo, Tahoma, Arial, sans-serif; background: var(--bg); color: var(--text); margin:0; }
    .container{max-width:1200px;margin:24px auto;padding:0 16px 48px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:12px;flex-wrap:wrap}
    .title{font-size:20px;font-weight:800}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .btn{border:1px solid var(--border);background:var(--card);padding:8px 12px;border-radius:12px;font-weight:600;font-size:14px;cursor:pointer}
    .btn:hover{box-shadow:0 4px 16px rgba(0,0,0,.06)}
    .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
    .btn.success{background:var(--success);color:#fff;border-color:transparent}
    .btn.danger{background:var(--danger);color:#fff;border-color:transparent}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 6px 24px rgba(0,0,0,.04)}
    .tabs{display:flex;gap:8px;margin:8px 0 16px}
    .tab{padding:8px 12px;border-radius:999px;border:1px solid var(--border);cursor:pointer;background:#fff}
    .tab.active{background:#0ea5e9;color:#fff;border-color:transparent}
    .subtabs{display:flex;gap:6px;margin-top:6px}
    .subtab{padding:6px 10px;border-radius:8px;border:1px solid var(--border);cursor:pointer;background:#fff;font-size:13px}
    .subtab.active{background:#f1f5f9}

    .filters{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
    select{border:1px solid var(--border);border-radius:10px;padding:8px 10px;background:#fff}

    .table-wrap{overflow:auto;border-radius:12px;border:1px solid var(--border);background:#fff}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{position:sticky;top:0;background:#f1f5f9;font-weight:800;font-size:13px;border-bottom:2px solid var(--border)}
    th,td{border-left:1px solid var(--border);border-bottom:1px solid var(--border);padding:10px;vertical-align:middle}
    thead th:first-child,tbody th{background:#f8fafc;font-weight:800}
    th:first-child,td:first-child{position:sticky;right:0;z-index:1}
    th:first-child{z-index:3}
    .cell{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .badge{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#fff;color:#64748b}
    .badge.ok{color:#065f46;background:#ecfdf5;border-color:#a7f3d0}
    .badge.issue{color:#7f1d1d;background:#fef2f2;border-color:#fecaca}
    .edit-btn{font-size:12px;border:1px dashed var(--border);background:#fff;padding:6px 8px;border-radius:10px;cursor:pointer}
    .edit-btn:hover{border-color:#8b5cf6}

    dialog::backdrop{background:rgb(15 23 42 / .55)}
    dialog{border:0;border-radius:16px;padding:0;max-width:720px;width:96%;box-shadow:0 20px 60px rgba(0,0,0,.25)}
    .modal header{padding:16px 20px;border-bottom:1px solid var(--border)}
    .modal header .subtitle{color:#64748b;font-size:12px;font-weight:600}
    .modal .content{padding:16px 20px;display:grid;gap:12px}
    .field{display:grid;gap:6px}
    label{font-size:13px;font-weight:700;color:#0f172a}
    input[type="text"],textarea,select{border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:14px;background:#fff;outline:none;transition:.15s ease;font-family:inherit}
    textarea{min-height:80px;resize:vertical}
    input:focus,textarea:focus,select:focus{border-color:#0ea5e9;box-shadow:0 0 0 4px rgba(14,165,233,.15)}
    .modal footer{padding:16px 20px;border-top:1px solid var(--border);display:flex;gap:8px}

    .floating-panel{position:sticky;top:12px;display:flex;gap:8px;align-items:center}
    .chip{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 10px;font-size:12px}

    /* Masthead */
    .masthead{background:#fff;border-bottom:1px solid var(--border);padding:18px 0 10px;margin:0 0 12px}
    .masthead .brand{display:grid;place-items:center;text-align:center;gap:8px}
    .masthead img{max-height:84px;max-width:220px;object-fit:contain}
    .masthead .ar{font-weight:800;font-size:18px;color:#0f172a}
    .masthead .ar-sub{font-size:14px;color:#334155}
    .masthead .en{font-size:12px;color:#64748b}
  </style>
</head>
<body>
  <div class="masthead">
    <div class="container brand">
      
      <div class="ar">Ø¬Ø§Ù…Ø¹Ø© Ø´Ù‚Ø±Ø§Ø¡</div>
      <div class="ar-sub">Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ© â€“ ÙØ±Ø¹ Ø§Ù„Ù‚ÙˆÙŠØ¹ÙŠØ© â€“ Ø´Ø·Ø± Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª</div>
      <div class="en">Shaqra University â€“ Applied College â€“ Al Quwaiiyah Branch â€“ Female Section</div>
    </div>
  </div>

  <div class="container">
    <header>
      <div class="title">Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ â€” Ù…Ø¹Ø§Ù…Ù„ 213 Ùˆ 215</div>
      <div class="toolbar">
        <button id="saveAll" class="btn success">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button id="exportXlsx" class="btn primary">ØªØµØ¯ÙŠØ± Excel</button>
        <button id="exportCsv" class="btn">ØªØµØ¯ÙŠØ± CSV</button>
        <button id="printPage" class="btn">Ø·Ø¨Ø§Ø¹Ø©</button>
        <button id="clearAll" class="btn danger">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </div>
    </header>

    <div class="card">
      <div class="tabs">
        <button class="tab active" data-lab="213">Ù…Ø¹Ù…Ù„ 213</button>
        <button class="tab" data-lab="215">Ù…Ø¹Ù…Ù„ 215</button>
      </div>
      <div class="subtabs">
        <button class="subtab active" data-view="report">Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <button class="subtab" data-view="performance">Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡</button>
      </div>

      <div class="filters">
        <label>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</label>
        <select id="weekSelect"></select>
        <div class="floating-panel">
          <span class="chip">
            <span>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„:</span>
            <select id="globalFault"></select>
          </span>
          <span class="chip">ØªÙ„Ù…ÙŠØ­: Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„ Ù‡Ù†Ø§ Ø«Ù… Ø­Ø±Ø± Ø£ÙŠ Ø¬Ù‡Ø§Ø² Ù„ØªØ¹Ø¨Ø¦ØªÙ‡ Ø³Ø±ÙŠØ¹Ù‹Ø§.</span>
        </div>
      </div>

      <div class="table-wrap" id="reportWrap">
        <table id="reportTable">
          <thead><tr><th>Ø§Ù„ÙŠÙˆÙ… \ Ø§Ù„Ø¬Ù‡Ø§Ø²</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="table-wrap" id="perfWrap" style="display:none">
        <table id="perfTable">
          <thead>
            <tr><th>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</th><th>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</th><th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ %</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <dialog id="cellDialog">
    <div class="modal">
      <header>
        <div>
          <div class="title">ØªØ¹Ø¨Ø¦Ø© Ø®Ù„ÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</div>
          <div class="subtitle" id="modalMeta"></div>
        </div>
      </header>
      <form method="dialog" id="cellForm">
        <div class="content">
          <div class="field">
            <label for="hasIssue">Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¹Ø·Ù„ØŸ</label>
            <select id="hasIssue" required>
              <option value="">â€” Ø§Ø®ØªØ± â€”</option>
              <option value="Ù„Ø§">Ù„Ø§</option>
              <option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
            </select>
          </div>

          <div class="field">
            <label for="faultType">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„</label>
            <select id="faultType"></select>
            <div class="hint">ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ø§Ø®ØªÙŠØ§Ø±Ùƒ ÙÙŠ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ø§Ø¦Ù…ØŒ ÙˆÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ù‡Ù†Ø§.</div>
          </div>

          <div class="field">
            <label for="action">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
            <input id="action" type="text" placeholder="ÙŠÙØ¹Ø¨Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„" />
          </div>

          <div class="field">
            <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
            <textarea id="notes" placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©â€¦"></textarea>
          </div>
        </div>
        <footer>
          <button class="btn" value="cancel">Ø¥Ù„ØºØ§Ø¡</button>
          <button class="btn success" id="saveBtn" value="default">Ø­ÙØ¸</button>
        </footer>
      </form>
    </div>
  </dialog>

  <script>
    const labs = [213, 215];
    const deviceCount = 17;
    const dayNames = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³"];
    const faultsMap = {
      "Ø¹Ø·Ù„ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø©": "ÙØ­Øµ ÙƒØ§Ø¨Ù„ Ø§Ù„Ø´Ø§Ø´Ø© (VGA / HDMI)ØŒ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¢Ø®Ø±ØŒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙƒØ§Ø¨Ù„ Ø£Ùˆ Ø§Ù„Ø´Ø§Ø´Ø© Ø¥Ø°Ø§ Ù„Ø²Ù….",
      "Ø¹Ø·Ù„ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­": "ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ù…Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØŒ ØªØ¬Ø±Ø¨Ø© ÙƒÙŠØ¨ÙˆØ±Ø¯ Ø¢Ø®Ø± Ù„Ù„ØªØ£ÙƒØ¯ØŒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø©.",
      "Ø¹Ø·Ù„ ÙÙŠ Ø§Ù„ÙØ£Ø±Ø©": "ÙØ­Øµ Ù…Ù†ÙØ° USBØŒ ØªØ¬Ø±Ø¨Ø© Ù…Ø§ÙˆØ³ Ø¢Ø®Ø±ØŒ ØªÙ†Ø¸ÙŠÙ Ø­Ø³Ø§Ø³ Ø§Ù„Ù…Ø§ÙˆØ³ Ø£Ùˆ ØªØºÙŠÙŠØ±Ù‡.",
      "Ø¹Ø¯Ù… Ø¥Ù‚Ù„Ø§Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù…": "ÙØ­Øµ ØªÙˆØµÙŠÙ„Ø§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ù‚Ø±Øµ Ø§Ù„ØµÙ„Ø¨ØŒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ BIOS Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¥Ø°Ø§ Ù„Ø²Ù….",
      "Ø¨Ø·Ø¡ ÙÙŠ Ø§Ù„Ø£Ø¯Ø§Ø¡": "Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©ØŒ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ØŒ ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ù† Ø§Ù„ÙÙŠØ±ÙˆØ³Ø§Øª.",
      "Ø¹Ø·Ù„ ÙÙŠ Ø§Ù„Ù‚Ø±Øµ Ø§Ù„ØµÙ„Ø¨": "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø¯ÙˆØ§Øª ÙØ­Øµ Ø§Ù„Ø£Ù‚Ø±Ø§Øµ (CHKDSK)ØŒ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠÙ‹Ø§ØŒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù‚Ø±Øµ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù‚Ø·Ø§Ø¹Ø§Øª ØªØ§Ù„ÙØ©.",
      "Ø§Ø±ØªÙØ§Ø¹ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©": "ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø±ÙˆØ­Ø© ÙˆØ§Ù„Ù…Ø¹Ø¬ÙˆÙ† Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØŒ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ‡ÙˆÙŠØ© Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ø±ÙˆØ­Ø© Ø¥Ø°Ø§ ØªÙˆÙ‚ÙØª.",
      "Ø¹Ø·Ù„ ÙÙŠ Ø§Ù„ØµÙˆØª": "ÙØ­Øµ ØªØ¹Ø±ÙŠÙ Ø§Ù„ØµÙˆØªØŒ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙˆØµÙŠÙ„ Ø§Ù„Ø³Ù…Ø§Ø¹Ø§ØªØŒ ØªØ¬Ø±Ø¨Ø© Ø³Ù…Ø§Ø¹Ø§Øª Ø¨Ø¯ÙŠÙ„Ø©ØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹Ø±ÙŠÙØ§Øª.",
      "Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ USB": "ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ù†ÙØ°ØŒ ØªØ­Ø¯ÙŠØ« ØªØ¹Ø±ÙŠÙØ§Øª USBØŒ ÙØ­Øµ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª BIOS Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ù†Ø§ÙØ°ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†ÙØ° Ø¢Ø®Ø±.",
      "Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙØ§Ø¬Ø¦": "ÙØ­Øµ ÙƒØ§Ø¨Ù„ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ØŒ ØªØ¬Ø±Ø¨Ø© Ù…ØµØ¯Ø± Ø·Ø§Ù‚Ø© Ø¢Ø®Ø±ØŒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù…Ø²ÙˆØ¯ Ø§Ù„Ø·Ø§Ù‚Ø© (Power Supply).",
      "Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…": "ØªØ´ØºÙŠÙ„ Ø£Ø¯Ø§Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ ÙØ­Øµ Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… SFC /scannow.",
      "ØªÙˆÙ‚Ù Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„": "Ø¥Ø¹Ø§Ø¯Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ØŒ ØªØ­Ø¯ÙŠØ«Ù‡ Ø¥Ù„Ù‰ Ø¢Ø®Ø± Ø¥ØµØ¯Ø§Ø±ØŒ ÙØ­Øµ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ Ø¨Ø±Ø§Ù…Ø¬ Ø£Ø®Ø±Ù‰.",
      "ÙÙŠØ±ÙˆØ³Ø§Øª Ø£Ùˆ Ø¨Ø±Ø§Ù…Ø¬ Ø®Ø¨ÙŠØ«Ø©": "Ø¥Ø¬Ø±Ø§Ø¡ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ø¨Ù…Ø¶Ø§Ø¯ ÙÙŠØ±ÙˆØ³Ø§Øª Ù…ÙˆØ«ÙˆÙ‚ØŒ Ø­Ø°Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØµØ§Ø¨Ø©ØŒ ØªØ«Ø¨ÙŠØª Ø­Ù…Ø§ÙŠØ© Ù…Ø­Ø¯Ø«Ø©.",
      "Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ ØªØ¹Ø±ÙŠÙØ§Øª Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©": "Ø§Ø³ØªØ®Ø¯Ø§Ù… Windows Update Ø£Ùˆ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµÙ†Ø¹Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹Ø±ÙŠÙØ§ØªØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª.",
      "ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ø§Ù„Ù…Ù„ÙØ§Øª": "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø¯ÙˆØ§Øª Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙØ­Øµ Ø§Ù„Ù‚Ø±ØµØŒ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¯ÙˆØ±ÙŠØ© Ù…Ø³ØªÙ‚Ø¨Ù„Ù‹Ø§.",
      "Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©": "ÙØ­Øµ ÙƒØ§Ø¨Ù„ Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§ÙŠ ÙØ§ÙŠØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯Ù…ØŒ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª IP.",
      "Ø¨Ø·Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª": "Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±Ø¹Ø©ØŒ ÙØµÙ„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©ØŒ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠØ©.",
      "Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¨ÙƒØ©": "Ø­Ø°Ù Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ØŒ ØªØ­Ø¯ÙŠØ« ØªØ¹Ø±ÙŠÙ ÙƒØ±Øª Ø§Ù„Ø´Ø¨ÙƒØ©ØŒ Ø¶Ø¨Ø· Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª DHCP.",
      "Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø´Ø¨ÙƒÙŠØ©": "Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù€ IPØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©ØŒ ÙØ­Øµ Ø§Ù„ÙƒØ§Ø¨Ù„."
    };
    const faultTypes = Object.keys(faultsMap);

    const STORAGE_KEY = "labReportStore.v2";
    let currentLab = 213;
    let currentView = 'report';
    let currentWeek = 1;

    function createEmptyStore(){
      const st = {};
      for (const lab of labs) {
        st[lab] = { report:{}, performance:{} };
        for (let w=1; w<=30; w++) {
          st[lab].report[w] = {};
          st[lab].performance[w] = {};
        }
      }
      return st;
    }

    let store = loadFromStorage() || createEmptyStore();

    function saveToStorage(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(store));
      alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
    }
    function loadFromStorage(){
      try { const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : null; }
      catch(e){ return null; }
    }

    const weekSelect = document.getElementById('weekSelect');
    for (let i=1;i<=30;i++){ const opt=document.createElement('option'); opt.value=i; opt.textContent=`Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i}`; weekSelect.appendChild(opt); }
    weekSelect.addEventListener('change',()=>{ currentWeek=parseInt(weekSelect.value); rebuild(); saveToStorage(); });

    const globalFault = document.getElementById('globalFault');
    faultTypes.forEach(f=>{ const o=document.createElement('option'); o.value=f; o.textContent=f; globalFault.appendChild(o);} );

    const reportTable = document.getElementById('reportTable');
    const theadRow = reportTable.tHead.rows[0];
    const tbody = reportTable.tBodies[0];

    function buildReportHead(){
      while (theadRow.cells.length>1) theadRow.deleteCell(1);
      for (let i = 1; i <= deviceCount; i++) {
        const th = document.createElement('th');
        th.textContent = i===17 ? 'Ø¬Ù‡Ø§Ø² Ø§Ù„Ø£Ø³ØªØ§Ø°' : i.toString();
        theadRow.appendChild(th);
      }
    }

    function buildReportBody(){
      tbody.innerHTML='';
      dayNames.forEach((day, dIdx)=>{
        const tr=document.createElement('tr');
        const th=document.createElement('th'); th.textContent=day; tr.appendChild(th);
        for(let dev=1;dev<=deviceCount;dev++){
          const td=document.createElement('td'); td.dataset.key=`${dIdx}-${dev}`;
          const cell=document.createElement('div'); cell.className='cell';
          const badge=document.createElement('span'); badge.className='badge'; badge.textContent='ØºÙŠØ± Ù…Ø¯Ø®Ù„';
          const edit=document.createElement('button'); edit.type='button'; edit.className='edit-btn'; edit.textContent='ØªØ­Ø±ÙŠØ±';
          edit.addEventListener('click',()=>openModal(dIdx,dev));
          cell.appendChild(badge); cell.appendChild(edit); td.appendChild(cell); tr.appendChild(td);
        }
        tbody.appendChild(tr);
      });
      refreshAllBadges();
    }

    const perfTable = document.getElementById('perfTable');
    const perfBody = perfTable.tBodies[0];
    function buildPerfBody(){
      perfBody.innerHTML='';
      for(let dev=1;dev<=deviceCount;dev++){
        const tr=document.createElement('tr');
        const tdNum=document.createElement('td'); tdNum.textContent=dev;
        const tdName=document.createElement('td'); tdName.textContent= dev===17 ? 'Ø¬Ù‡Ø§Ø² Ø§Ù„Ø£Ø³ØªØ§Ø°' : dev;
        const tdPerc=document.createElement('td');
        const input=document.createElement('input'); input.type='number'; input.min='0'; input.max='100'; input.placeholder='%';
        input.value = store[currentLab].performance[currentWeek][dev] ?? '';
        input.addEventListener('input',()=>{ store[currentLab].performance[currentWeek][dev]=input.value; });
        input.addEventListener('change',()=>{ saveToStorage(); });
        tdPerc.appendChild(input);
        tr.appendChild(tdNum); tr.appendChild(tdName); tr.appendChild(tdPerc); perfBody.appendChild(tr);
      }
    }

    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click',()=>{ document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); currentLab=parseInt(btn.dataset.lab); rebuild(); });
    });

    document.querySelectorAll('.subtab').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.subtab').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active'); currentView=btn.dataset.view; toggleViews(); });
    });

    function toggleViews(){
      if(currentView==='report'){ document.getElementById('reportWrap').style.display='block'; document.getElementById('perfWrap').style.display='none'; }
      else { document.getElementById('reportWrap').style.display='none'; document.getElementById('perfWrap').style.display='block'; buildPerfBody(); }
    }

    function rebuild(){
      buildReportHead();
      buildReportBody();
      toggleViews();
    }

    const dialog = document.getElementById('cellDialog');
    const hasIssueEl = document.getElementById('hasIssue');
    const faultSelect = document.getElementById('faultType');
    const actionEl = document.getElementById('action');
    const notesEl = document.getElementById('notes');
    const modalMeta = document.getElementById('modalMeta');

    function fillFaultSelect(){ faultSelect.innerHTML=''; faultTypes.forEach(f=>{ const o=document.createElement('option'); o.value=f; o.textContent=f; faultSelect.appendChild(o);}); }
    fillFaultSelect();

    function setDisabledFields(disabled){ faultSelect.disabled=disabled; actionEl.disabled=disabled; notesEl.disabled=disabled; }
    hasIssueEl.addEventListener('change',()=> setDisabledFields(hasIssueEl.value==='Ù„Ø§'));

    function openModal(dayIndex, device){
      const key=`${dayIndex}-${device}`;
      const rec=store[currentLab].report[currentWeek][key] || {hasIssue:'',faultType:'',action:'',notes:''};
      hasIssueEl.value = rec.hasIssue;
      fillFaultSelect();
      if(!rec.faultType && document.getElementById('globalFault').value){ rec.faultType = document.getElementById('globalFault').value; }
      faultSelect.value = rec.faultType;
      actionEl.value = rec.action || faultsMap[faultSelect.value] || '';
      notesEl.value = rec.notes;
      setDisabledFields(hasIssueEl.value==='Ù„Ø§');
      modalMeta.textContent = `${dayNames[dayIndex]} â€“ ${device===17?'Ø¬Ù‡Ø§Ø² Ø§Ù„Ø£Ø³ØªØ§Ø°':('Ø¬Ù‡Ø§Ø² '+device)}`;
      dialog.dataset.key = key;
      dialog.showModal();
    }

    faultSelect.addEventListener('change',()=>{ actionEl.value = faultsMap[faultSelect.value] || ''; });

    document.getElementById('cellForm').addEventListener('submit',(e)=>{
      e.preventDefault();
      const key=dialog.dataset.key;
      store[currentLab].report[currentWeek][key] = {
        hasIssue: hasIssueEl.value,
        faultType: hasIssueEl.value==='Ù„Ø§' ? '' : faultSelect.value,
        action: hasIssueEl.value==='Ù„Ø§' ? '' : actionEl.value,
        notes: hasIssueEl.value==='Ù„Ø§' ? '' : notesEl.value,
      };
      updateBadge(key);
      dialog.close();
      saveToStorage();
    });

    function updateBadge(key){
      const td = document.getElementById('reportTable').tBodies[0].querySelector(`[data-key="${key}"]`);
      if(!td) return; const badge = td.querySelector('.badge');
      const rec = store[currentLab].report[currentWeek][key];
      if(!rec || !rec.hasIssue){ badge.textContent='ØºÙŠØ± Ù…Ø¯Ø®Ù„'; badge.className='badge'; }
      else if(rec.hasIssue==='Ù„Ø§'){ badge.textContent='Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ø·Ù„'; badge.className='badge ok'; }
      else { badge.textContent='ÙŠÙˆØ¬Ø¯ Ø¹Ø·Ù„'; badge.className='badge issue'; }
    }

    function refreshAllBadges(){
      for(let dIdx=0; dIdx<dayNames.length; dIdx++){ for(let dev=1; dev<=deviceCount; dev++){ updateBadge(`${dIdx}-${dev}`); } }
    }

    function exportCSV(){
      const rows = [["Ø§Ù„Ù…Ø¹Ù…Ù„","Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹","Ø§Ù„ÙŠÙˆÙ…","Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²","Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²","Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¹Ø·Ù„ØŸ","Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„","Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨","Ù…Ù„Ø§Ø­Ø¸Ø§Øª","Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ %"]];
      for(const lab of labs){
        for(let w=1; w<=30; w++){
          for(let dIdx=0; dIdx<dayNames.length; dIdx++){
            for(let dev=1; dev<=deviceCount; dev++){
              const key=`${dIdx}-${dev}`;
              const r = store[lab].report[w][key] || {};
              const perf = store[lab].performance[w][dev] || '';
              rows.push([lab, w, dayNames[dIdx], dev, (dev===17?'Ø¬Ù‡Ø§Ø² Ø§Ù„Ø£Ø³ØªØ§Ø°':dev), r.hasIssue||'', r.faultType||'', r.action||'', r.notes||'', perf]);
            }
          }
        }
      }
      const csv = rows.map(r=>r.map(field=>{ const s=String(field??''); return (s.includes(',')||s.includes('"')||s.includes('\n'))? '"'+s.replace(/"/g,'""')+'"': s; }).join(',')).join('\n');
      const blob = new Blob(["\ufeff"+csv], {type:'text/csv;charset=utf-8'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='ØªÙ‚Ø§Ø±ÙŠØ±_Ø§Ù„Ù…Ø¹Ù…Ù„_213_Ùˆ_215_Ù„Ù€30_Ø£Ø³Ø¨ÙˆØ¹.csv'; a.click(); URL.revokeObjectURL(a.href);
    }

    function exportXLSX(){
      const wb = XLSX.utils.book_new();
      const header = ["Ø§Ù„Ù…Ø¹Ù…Ù„","Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹","Ø§Ù„ÙŠÙˆÙ…","Ø±Ù‚Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²","Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²","Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¹Ø·Ù„ØŸ","Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„","Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨","Ù…Ù„Ø§Ø­Ø¸Ø§Øª","Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ %"];
      const rows = [header];
      for(const lab of labs){
        for(let w=1; w<=30; w++){
          for(let dIdx=0; dIdx<dayNames.length; dIdx++){
            for(let dev=1; dev<=deviceCount; dev++){
              const key=`${dIdx}-${dev}`;
              const r = store[lab].report[w][key] || {};
              const perf = store[lab].performance[w][dev] || '';
              rows.push([lab, w, dayNames[dIdx], dev, (dev===17?'Ø¬Ù‡Ø§Ø² Ø§Ù„Ø£Ø³ØªØ§Ø°':dev), r.hasIssue||'', r.faultType||'', r.action||'', r.notes||'', perf]);
            }
          }
        }
      }
      const ws = XLSX.utils.aoa_to_sheet(rows);
      XLSX.utils.book_append_sheet(wb, ws, "ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ù…Ù„");
      XLSX.writeFile(wb, "ØªÙ‚Ø§Ø±ÙŠØ±_Ø§Ù„Ù…Ø¹Ù…Ù„_213_Ùˆ_215_Ù„Ù€30_Ø£Ø³Ø¨ÙˆØ¹.xlsx");
    }

    document.getElementById('exportCsv').addEventListener('click', exportCSV);
    document.getElementById('exportXlsx').addEventListener('click', exportXLSX);
    document.getElementById('printPage').addEventListener('click',()=>window.print());
    document.getElementById('saveAll').addEventListener('click', saveToStorage);
    document.getElementById('clearAll').addEventListener('click',()=>{
      if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
      store = createEmptyStore();
      saveToStorage();
      rebuild();
    });

    window.addEventListener('DOMContentLoaded',()=>{
      weekSelect.value = String(currentWeek);
      rebuild();
    });
  </script>
</body>
</html>
